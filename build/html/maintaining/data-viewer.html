<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Data preview and visualization &mdash; DRDSI CKAN doc</title>
    
    <link rel="stylesheet" href="../_static/geosolutions.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '20140422',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="DRDSI CKAN doc" href="../index.html" />
    

  </head>
  <body>
    <div class="header">
        <div class="wrap">
			
            <div class="logo">
			<a href="http://geo-solutions.it/"><img src="../_static/img/geosolutions.png" alt="GeoSolutions" /></a>
			<div class="social-container"> 
				<ul id="social">
					<li><a href="https://plus.google.com/u/0/100131944378031878024/posts" id="gplus">Google+</a></li>
					<li><a href="http://twitter.com/geosolutions_it/" id="twitter">Twitter</a></li>
				</ul>
			</div>
			</div>
					
            <h2 class="docstitle"><a href="../index.html">DRDSI CKAN doc</a></h2>
			
        </div>
    </div>


      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Data preview and visualization</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#managing-resource-views">Managing resource views</a></li>
<li><a class="reference internal" href="#defining-views-to-appear-by-default">Defining views to appear by default</a></li>
<li><a class="reference internal" href="#available-view-plugins">Available view plugins</a><ul>
<li><a class="reference internal" href="#data-explorer">Data Explorer</a></li>
<li><a class="reference internal" href="#datastore-grid">DataStore Grid</a></li>
<li><a class="reference internal" href="#datastore-graph">DataStore Graph</a></li>
<li><a class="reference internal" href="#datastore-map">DataStore Map</a></li>
<li><a class="reference internal" href="#text-view">Text view</a></li>
<li><a class="reference internal" href="#image-view">Image view</a></li>
<li><a class="reference internal" href="#web-page-view">Web page view</a></li>
<li><a class="reference internal" href="#other-view-plugins">Other view plugins</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resource-proxy">Resource Proxy</a></li>
<li><a class="reference internal" href="#migrating-from-previous-ckan-versions">Migrating from previous CKAN versions</a></li>
<li><a class="reference internal" href="#command-line-interface">Command line interface</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/maintaining/data-viewer.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="data-preview-and-visualization">
<h1><a class="toc-backref" href="#id3">Data preview and visualization</a><a class="headerlink" href="#data-preview-and-visualization" title="Permalink to this headline">¶</a></h1>
<div class="versionchanged">
<p><span class="versionmodified">Changed in version 2.3: </span>The whole way resource previews are handled was changed on CKAN 2.3.
Please refer to previous versions of the documentation if you are using
an older CKAN version.</p>
</div>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#data-preview-and-visualization" id="id3">Data preview and visualization</a><ul>
<li><a class="reference internal" href="#overview" id="id4">Overview</a></li>
<li><a class="reference internal" href="#managing-resource-views" id="id5">Managing resource views</a></li>
<li><a class="reference internal" href="#defining-views-to-appear-by-default" id="id6">Defining views to appear by default</a></li>
<li><a class="reference internal" href="#available-view-plugins" id="id7">Available view plugins</a><ul>
<li><a class="reference internal" href="#data-explorer" id="id8">Data Explorer</a></li>
<li><a class="reference internal" href="#datastore-grid" id="id9">DataStore Grid</a></li>
<li><a class="reference internal" href="#datastore-graph" id="id10">DataStore Graph</a></li>
<li><a class="reference internal" href="#datastore-map" id="id11">DataStore Map</a></li>
<li><a class="reference internal" href="#text-view" id="id12">Text view</a></li>
<li><a class="reference internal" href="#image-view" id="id13">Image view</a></li>
<li><a class="reference internal" href="#web-page-view" id="id14">Web page view</a></li>
<li><a class="reference internal" href="#other-view-plugins" id="id15">Other view plugins</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resource-proxy" id="id16">Resource Proxy</a></li>
<li><a class="reference internal" href="#migrating-from-previous-ckan-versions" id="id17">Migrating from previous CKAN versions</a></li>
<li><a class="reference internal" href="#command-line-interface" id="id18">Command line interface</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id4">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The CKAN resource page can contain one or more visualizations of the resource
data or file contents (a table, a bar chart, a map, etc). These are commonly
referred to as <em>resource views</em>.</p>
<img alt="../_images/views_overview.png" src="../_images/views_overview.png" />
<p>The main features of resource views are:</p>
<ul class="simple">
<li>One resource can have multiple views of the same data (for example a grid
and some graphs for tabular data).</li>
<li>Dataset editors can choose which views to show, reorder them and configure
them individually.</li>
<li>Individual views can be embedded on external sites.</li>
</ul>
<p>Different view types are implemented via custom plugins, which can be activated
on a particular CKAN site. Once these plugins are added, instance
administrators can decide which views should be created by default if the
resource is suitable (for instance a table on resources uploaded to the
DataStore, a map for spatial data, etc.).</p>
<p>Whether a particular resource can be rendered by the different view plugins is
decided by the view plugins themselves. This is generally done checking the
resource format or whether its data is on the <a class="reference internal" href="datastore.html"><em>DataStore extension</em></a> or
not.</p>
</div>
<div class="section" id="managing-resource-views">
<h2><a class="toc-backref" href="#id5">Managing resource views</a><a class="headerlink" href="#managing-resource-views" title="Permalink to this headline">¶</a></h2>
<p>Users who are allowed to edit a particular dataset can also manage the views
for its resources. To access the management interface, click on the <em>Manage</em>
button on the resource page and then on the <em>Views</em> tab. From here you can
create new views, update or delete existing ones and reorder them.</p>
<img alt="../_images/manage_views.png" src="../_images/manage_views.png" />
<p>The <em>New view</em> dropdown will show the available view types for this particular
resource. If the list is empty, you may need to add the relevant view plugins
to the <a class="reference internal" href="configuration.html#ckan-plugins"><em>ckan.plugins</em></a> setting on your configuration file, eg:</p>
<div class="highlight-python"><div class="highlight"><pre>ckan.plugins = ... image_view recline_view pdf_view
</pre></div>
</div>
</div>
<div class="section" id="defining-views-to-appear-by-default">
<h2><a class="toc-backref" href="#id6">Defining views to appear by default</a><a class="headerlink" href="#defining-views-to-appear-by-default" title="Permalink to this headline">¶</a></h2>
<p>From the management interface you can create and edit views manually, but in most
cases you will want views to be created automatically on certain resource types,
so data can be visualized straight away after uploading or linking to a file.</p>
<p>To do so, you define a set of view plugins that should be checked whenever a
dataset or resource is created or updated. For each of them, if the resource is
a suitable one, a view will be created.</p>
<p>This is configured with the <a class="reference internal" href="configuration.html#ckan-views-default-views"><em>ckan.views.default_views</em></a> setting. In it you
define the view plugins that you want to be created as default:</p>
<div class="highlight-python"><div class="highlight"><pre>ckan.views.default_views = recline_view pdf_view geojson_view
</pre></div>
</div>
<p>This configuration does not mean that each new resource will get all of these
views by default, but that for instance if the uploaded file is a PDF file,
a PDF viewer will be created automatically and so on.</p>
</div>
<div class="section" id="available-view-plugins">
<h2><a class="toc-backref" href="#id7">Available view plugins</a><a class="headerlink" href="#available-view-plugins" title="Permalink to this headline">¶</a></h2>
<p>Some view plugins for common formats are included in the main CKAN repository.
These don&#8217;t require further setup and can be directly added to the
<a class="reference internal" href="configuration.html#ckan-plugins"><em>ckan.plugins</em></a> setting.</p>
<div class="section" id="data-explorer">
<span id="id1"></span><h3><a class="toc-backref" href="#id8">Data Explorer</a><a class="headerlink" href="#data-explorer" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/recline_view.png" src="../_images/recline_view.png" />
<p>View plugin: <tt class="docutils literal"><span class="pre">recline_view</span></tt></p>
<p>Adds a rich widget, based on the <a class="reference external" href="https://github.com/okfn/recline/">Recline</a> Javascript library. It  allows
querying, filtering, graphing and mapping data. The Data Explorer is optimized
for displaying structured data hosted on the <a class="reference internal" href="datastore.html"><em>DataStore extension</em></a>.</p>
<p>The Data Explorer can also display certain formats of tabular data (CSV and
Excel files) without its contents being uploaded to the DataStore. This is
done via the <a class="reference external" href="https://github.com/okfn/dataproxy">DataProxy</a>, an external service that will parse the contents of
the file and return a response that the view widget understands. However, as
the resource must be downloaded by the DataProxy service and parsed before it
is viewed, this option is slower and less reliable than viewing data that is
in the DataStore. It also does not properly support different encodings, proper
field type detection, etc so users are strongly encouraged to host data on the
DataStore instead.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Support for the DataProxy will be dropped on future CKAN releases</p>
</div>
<p>The three main panes of the Data Explorer are also available as separate views.</p>
</div>
<div class="section" id="datastore-grid">
<h3><a class="toc-backref" href="#id9">DataStore Grid</a><a class="headerlink" href="#datastore-grid" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/recline_grid_view.png" src="../_images/recline_grid_view.png" />
<p>View plugin: <tt class="docutils literal"><span class="pre">recline_grid_view</span></tt></p>
<p>Displays a filterable, sortable, table view of structured data.</p>
<p>This plugin requires data to be in the DataStore.</p>
</div>
<div class="section" id="datastore-graph">
<h3><a class="toc-backref" href="#id10">DataStore Graph</a><a class="headerlink" href="#datastore-graph" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/recline_graph_view.png" src="../_images/recline_graph_view.png" />
<p>View plugin: <tt class="docutils literal"><span class="pre">recline_graph_view</span></tt></p>
<p>Allows to create graphs from data stored on the DataStore. You can choose the
graph type (such as lines, bars, columns, etc) and restrict the displayed data,
by filtering by a certain field value or defining an offset and the number of
rows.</p>
<p>This plugin requires data to be in the DataStore.</p>
</div>
<div class="section" id="datastore-map">
<h3><a class="toc-backref" href="#id11">DataStore Map</a><a class="headerlink" href="#datastore-map" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/recline_map_view.png" src="../_images/recline_map_view.png" />
<p>View plugin: <tt class="docutils literal"><span class="pre">recline_map_view</span></tt></p>
<p>Shows data stored on the DataStore in an interactive map. It supports plotting
markers from a pair of latitude / longitude fields or from a field containing
a <a class="reference external" href="http://geojson.org">GeoJSON</a> representation of the geometries. The configuration also allows to
cluster markers if there is a high density of them and to zoom automatically
to the rendered features.</p>
<p>This plugin requires data to be in the DataStore.</p>
</div>
<div class="section" id="text-view">
<h3><a class="toc-backref" href="#id12">Text view</a><a class="headerlink" href="#text-view" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/text_view.png" src="../_images/text_view.png" />
<p>View plugin: <tt class="docutils literal"><span class="pre">text_view</span></tt></p>
<p>Displays files in XML, JSON or plain text based formats with the syntax
highlighted. The formats detected can be configured using the
<a class="reference internal" href="configuration.html#ckan-preview-xml-formats"><em>ckan.preview.xml_formats</em></a>, <a class="reference internal" href="configuration.html#ckan-preview-json-formats"><em>ckan.preview.json_formats</em></a>
and <a class="reference internal" href="configuration.html#ckan-preview-text-formats"><em>ckan.preview.text_formats</em></a> configuration options respectively.</p>
<p>If you want to display files that are hosted in a different server from your
CKAN instance (eg that haven&#8217;t been uploaded to CKAN) you will need to enable
the <a class="reference internal" href="#id2">Resource Proxy</a> plugin.</p>
</div>
<div class="section" id="image-view">
<h3><a class="toc-backref" href="#id13">Image view</a><a class="headerlink" href="#image-view" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/image_view.png" src="../_images/image_view.png" />
<p>View plugin: <tt class="docutils literal"><span class="pre">image_view</span></tt></p>
<p>If the resource format is a common image format like PNG, JPEG or GIF, it adds
an <tt class="docutils literal"><span class="pre">&lt;img&gt;</span></tt> tag pointing to the resource URL. You can provide an alternative
URL on the edit view form.</p>
</div>
<div class="section" id="web-page-view">
<h3><a class="toc-backref" href="#id14">Web page view</a><a class="headerlink" href="#web-page-view" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/webpage_view.png" src="../_images/webpage_view.png" />
<p>View plugin: <tt class="docutils literal"><span class="pre">webpage_view</span></tt></p>
<p>Adds an <tt class="docutils literal"><span class="pre">&lt;iframe&gt;</span></tt> tag to embed the resource URL. You can provide an
alternative URL on the edit view form.</p>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not activate this plugin unless you trust the URL sources.
It is not recommended to enable this view type on instances where all users
can create datasets.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="other-view-plugins">
<h3><a class="toc-backref" href="#id15">Other view plugins</a><a class="headerlink" href="#other-view-plugins" title="Permalink to this headline">¶</a></h3>
<p>There are many more view plugins developed by the CKAN team and others which
are hosted on separate repositories. Some examples include:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ckan/ckanext-dashboard">Dashboard</a>: Allows to combine multiple views into a single dashboard.</li>
<li><a class="reference external" href="https://github.com/ckan/ckanext-pdfview">PDF viewer</a>: Allows to render PDF files on the resource page.</li>
<li><a class="reference external" href="https://github.com/ckan/ckanext-spatial">GeoJSON map</a>: Renders <a class="reference external" href="http://geojson.org">GeoJSON</a> files on an interactive map.</li>
<li><a class="reference external" href="https://github.com/ckan/ckanext-mapviews">Choropleth map</a>: Displays data on the DataStore on a choropleth map.</li>
<li><a class="reference external" href="https://github.com/ckan/ckanext-basiccharts">Basic charts</a>: Provides alternative graph types and renderings.</li>
</ul>
<p>If you want to add another view type to this list, edit this file by sending
a pull request on GitHub.</p>
<p>New plugins to render custom view types can be implemented using
the <tt class="xref py py-class docutils literal"><span class="pre">IResourceView</span></tt> interface.</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Link to a proper tutorial for writing custom views</p>
</div>
</div>
</div>
<div class="section" id="resource-proxy">
<span id="id2"></span><h2><a class="toc-backref" href="#id16">Resource Proxy</a><a class="headerlink" href="#resource-proxy" title="Permalink to this headline">¶</a></h2>
<p>As resource views are rendered on the browser, if the file they are accessing
is located in a different domain than the one CKAN is hosted, the browser will
block access to it because of the <a class="reference external" href="http://en.wikipedia.org/wiki/Same_origin_policy">same-origin policy</a>. For instance, files
hosted on <cite>www.example.com</cite> won&#8217;t be able to be accessed from the browser if
CKAN is hosted on <cite>data.catalog.com</cite>.</p>
<p>To allow view plugins access to external files you need to activate the
<tt class="docutils literal"><span class="pre">resource_proxy</span></tt> plugin on your configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre>ckan.plugins = resource_proxy ...
</pre></div>
</div>
<p>This will request the file on the server side and serve it from the same domain
as CKAN.</p>
<p>You can modify the maximum allowed size for proxied files using the
<a class="reference internal" href="configuration.html#ckan-resource-proxy-max-file-size"><em>ckan.resource_proxy.max_file_size</em></a> configuration setting.</p>
</div>
<div class="section" id="migrating-from-previous-ckan-versions">
<h2><a class="toc-backref" href="#id17">Migrating from previous CKAN versions</a><a class="headerlink" href="#migrating-from-previous-ckan-versions" title="Permalink to this headline">¶</a></h2>
<p>If you are upgrading an existing instance running CKAN version 2.2.x or lower
to CKAN 2.3 or higher, you need to perform a migration process in order for the
resource views to appear. If the migration does not take place, resource views
will only appear when creating or updating datasets or resources, but not on
existing ones.</p>
<p>The migration process involves creating the necessary view objects in the
database, which can be done using the <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">views</span> <span class="pre">create</span></tt> command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">views</span> <span class="pre">create</span></tt> command uses the search API to get all
necessary datasets and resources, so make sure your search
index <a class="reference internal" href="paster.html#rebuild-search-index"><em>is up to date</em></a> before starting the
migration process.</p>
</div>
<p>The way the <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">views</span> <span class="pre">create</span></tt> commands works is getting all or a subset
of the instance datasets from the search index, and for each of them checking
against a list of view plugins if it is necessary to create a view object. This
gets determined by each of the individual view plugins depending on the dataset&#8217;s
resources fields.</p>
<p>Before each run, you will be prompted with the number of datasets affected and
asked if you want to continue (unless you pass the <tt class="docutils literal"><span class="pre">-y</span></tt> option):</p>
<div class="highlight-python"><div class="highlight"><pre>You are about to check 3336 datasets for the following view plugins: [&#39;image_view&#39;, &#39;recline_view&#39;, &#39;text_view&#39;]
 Do you want to continue? [Y/n]
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On large CKAN instances the migration process can take a significant
time if using the default options. It is worth planning in advance and split
the process using the search parameters to only check relevant datasets.
The following documentation provides guidance on how to do this.</p>
</div>
<p>If no view types are provided, the default ones are used
(check <a class="reference internal" href="#defining-views-to-appear-by-default">Defining views to appear by default</a> to see how these are defined):</p>
<div class="highlight-python"><div class="highlight"><pre>paster views create
</pre></div>
</div>
<p>Specific view types can be also provided:</p>
<div class="highlight-python"><div class="highlight"><pre>paster views create image_view recline_view pdf_view
</pre></div>
</div>
<p>For certain view types (the ones with plugins included in the main CKAN core),
default filters are applied to the search to only get relevant resources. For
instance if <tt class="docutils literal"><span class="pre">image_view</span></tt> is defined, filters are added to the search to only
get datasets with resources that have image formats (png, jpg, etc).</p>
<p>You can also provide arbitrary search parameters like the ones supported by
<tt class="xref py py-func docutils literal"><span class="pre">package_search()</span></tt>. This can be useful for
instance to only include datasets with resources of a certain format:</p>
<div class="highlight-python"><div class="highlight"><pre>paster views create geojson_view -s &#39;{&quot;fq&quot;: &quot;res_format:GEOJSON&quot;}&#39;
</pre></div>
</div>
<p>To instead avoid certain formats you can do:</p>
<div class="highlight-python"><div class="highlight"><pre>paster views create -s &#39;{&quot;fq&quot;: &quot;-res_format:HTML&quot;}&#39;
</pre></div>
</div>
<p>Of course this is not limited to resource formats, you can filter out or in
using any field, as in a normal dataset search:</p>
<div class="highlight-python"><div class="highlight"><pre>paster views create -s &#39;{&quot;q&quot;: &quot;groups:visualization-examples&quot;}&#39;
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you set the <tt class="docutils literal"><span class="pre">ckan_logger</span></tt> level to <tt class="docutils literal"><span class="pre">DEBUG</span></tt> on your
configuration file you can see the full search parameters being sent
to Solr.</p>
</div>
<p>For convenience, there is also an option to create views on a particular
dataset or datasets:</p>
<div class="highlight-python"><div class="highlight"><pre>paster views create -d dataset_id

paster views create -d dataset_name -d dataset_name
</pre></div>
</div>
</div>
<div class="section" id="command-line-interface">
<h2><a class="toc-backref" href="#id18">Command line interface</a><a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">views</span></tt> command allows to create and remove resource views objects
from the database in bulk.</p>
<p>Check the command help for the full options:</p>
<div class="highlight-python"><div class="highlight"><pre>paster views create -h
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Tutorial for writing custom view types.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
            <li class="right" style="margin-right: 10px">
              <a href="../genindex.html" title="General Index"
                 accesskey="I">index</a></li>
        <li><a href="../index.html">doc</a> &raquo;</li>
        <li><a href="#">Data preview and visualization</a></li>
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014 GeoSolutions.
      Last updated on Aug 03, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>