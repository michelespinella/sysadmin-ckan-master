<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Customizing CKAN’s templates &mdash; DRDSI CKAN doc</title>
    
    <link rel="stylesheet" href="../_static/geosolutions.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '20140422',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="DRDSI CKAN doc" href="../index.html" />
    

  </head>
  <body>
    <div class="header">
        <div class="wrap">
			
            <div class="logo">
			<a href="http://geo-solutions.it/"><img src="../_static/img/geosolutions.png" alt="GeoSolutions" /></a>
			<div class="social-container"> 
				<ul id="social">
					<li><a href="https://plus.google.com/u/0/100131944378031878024/posts" id="gplus">Google+</a></li>
					<li><a href="http://twitter.com/geosolutions_it/" id="twitter">Twitter</a></li>
				</ul>
			</div>
			</div>
					
            <h2 class="docstitle"><a href="../index.html">DRDSI CKAN doc</a></h2>
			
        </div>
    </div>


      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Customizing CKAN&#8217;s templates</a><ul>
<li><a class="reference internal" href="#creating-a-ckan-extension">Creating a CKAN extension</a></li>
<li><a class="reference internal" href="#replacing-a-default-template-file">Replacing a default template file</a></li>
<li><a class="reference internal" href="#jinja2">Jinja2</a><ul>
<li><a class="reference internal" href="#expressions-and-variables">Expressions and variables</a></li>
<li><a class="reference internal" href="#tags">Tags</a></li>
<li><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extending-templates-with-ckan-extends">Extending templates with <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">ckan_extends</span> <span class="pre">%}</span></tt></a></li>
<li><a class="reference internal" href="#replacing-template-blocks-with-block">Replacing template blocks with <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">%}</span></tt></a></li>
<li><a class="reference internal" href="#extending-parent-blocks-with-jinja-s-super">Extending parent blocks with Jinja&#8217;s <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></tt></a></li>
<li><a class="reference internal" href="#template-helper-functions">Template helper functions</a></li>
<li><a class="reference internal" href="#adding-your-own-template-helper-functions">Adding your own template helper functions</a></li>
<li><a class="reference internal" href="#template-snippets">Template snippets</a></li>
<li><a class="reference internal" href="#adding-your-own-template-snippets">Adding your own template snippets</a></li>
<li><a class="reference internal" href="#html-tags-and-css-classes">HTML tags and CSS classes</a></li>
<li><a class="reference internal" href="#accessing-custom-config-settings-from-templates">Accessing custom config settings from templates</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/theming/templates.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="customizing-ckan-s-templates">
<h1>Customizing CKAN&#8217;s templates<a class="headerlink" href="#customizing-ckan-s-templates" title="Permalink to this headline">¶</a></h1>
<p>CKAN pages are generated from <a class="reference internal" href="#jinja2">Jinja2</a> template files. This tutorial will walk
you through the process of writing your own template files to modify and
replace the default ones, and change the layout and content of CKAN pages.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="../contributing/string-i18n.html"><em>String internationalization</em></a></dt>
<dd>How to mark strings for translation in your template files.</dd>
</dl>
</div>
<div class="section" id="creating-a-ckan-extension">
<h2>Creating a CKAN extension<a class="headerlink" href="#creating-a-ckan-extension" title="Permalink to this headline">¶</a></h2>
<p>A CKAN theme is simply a CKAN plugin that contains some custom templates and
static files, so before getting started on our CKAN theme we&#8217;ll have to create
an extension and plugin. For a detailed explanation of the steps below, see
<a class="reference internal" href="../extensions/tutorial.html"><em>Writing extensions tutorial</em></a>.</p>
<ol class="arabic">
<li><p class="first">Use the <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">create</span></tt> command to create an empty extension:</p>
<pre class="literal-block">
<a href="#id4"><span class="problematic" id="id5">|activate|</span></a>
cd <a href="#id6"><span class="problematic" id="id7">|virtualenv|</span></a>/src
paster --plugin=ckan create -t ckanext <tt class="docutils literal"><span class="pre">ckanext-example_theme</span></tt>
</pre>
</li>
<li><p class="first">Create the file <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/plugin.py</span></tt> with the following contents:</p>
</li>
<li><p class="first">Edit the <tt class="docutils literal"><span class="pre">entry_points</span></tt> in <tt class="docutils literal"><span class="pre">ckanext-example_theme/setup.py</span></tt> to look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">entry_points</span><span class="o">=</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">    [ckan.plugins]</span>
<span class="s">    example_theme=ckanext.example_theme.plugin:ExampleThemePlugin</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p class="first">Run <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">develop</span></tt>:</p>
<pre class="literal-block">
cd <tt class="docutils literal"><span class="pre">ckanext-example_theme</span></tt>
python setup.py develop
</pre>
</li>
<li><p class="first">Add the plugin to the <tt class="docutils literal"><span class="pre">ckan.plugins</span></tt> setting in your <a href="#id8"><span class="problematic" id="id9">|development.ini|</span></a>
file:</p>
<div class="highlight-python"><div class="highlight"><pre>ckan.plugins = stats text_view recline_view example_theme
</pre></div>
</div>
</li>
<li><p class="first">Start CKAN in the development web server:</p>
<div class="highlight-python"><div class="highlight"><pre>$ paster serve --reload |development.ini|
Starting server in PID 13961.
serving on 0.0.0.0:5000 view at http://127.0.0.1:5000
</pre></div>
</div>
<p>Open the <a href="#id14"><span class="problematic" id="id15">`CKAN front page`_</span></a> in your web browser.  If your plugin is in the
<a class="reference internal" href="../maintaining/configuration.html#ckan-plugins"><em>ckan.plugins</em></a> setting and CKAN starts without crashing, then your
plugin is installed and CKAN can find it. Of course, your plugin doesn&#8217;t
<em>do</em> anything yet.</p>
</li>
</ol>
</div>
<div class="section" id="replacing-a-default-template-file">
<span id="template-overriding"></span><h2>Replacing a default template file<a class="headerlink" href="#replacing-a-default-template-file" title="Permalink to this headline">¶</a></h2>
<p>Every CKAN page is generated by rendering a particular template. For each
page of a CKAN site there&#8217;s a corresponding template file. For example the
front page is generated from the
<a class="reference external" href="https://github.com/ckan/ckan/blob/master/ckan/templates/home/index.html">ckan/templates/home/index.html</a>
file, the <tt class="docutils literal"><span class="pre">/about</span></tt> page is generated from
<a class="reference external" href="https://github.com/ckan/ckan/blob/master/ckan/templates/home/about.html">ckan/templates/home/about.html</a>,
the datasets page at <tt class="docutils literal"><span class="pre">/dataset</span></tt> is generated from
<a class="reference external" href="https://github.com/ckan/ckan/blob/master/ckan/templates/package/search.html">ckan/templates/package/search.html</a>,
etc.</p>
<p>To customize pages, our plugin needs to register its own custom template
directory containing template files that override the default ones.
Edit the <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/plugin.py</span></tt> file that we created earlier, so that it looks like
this:</p>
<p>This new code does a few things:</p>
<ol class="arabic">
<li><p class="first">It imports CKAN&#8217;s <a class="reference internal" href="../extensions/plugins-toolkit.html"><em>plugins toolkit</em></a>
module:</p>
<p>The plugins toolkit is a Python module containing core functions, classes
and exceptions for CKAN plugins to use. For more about the plugins toolkit,
see <a class="reference internal" href="../extensions/tutorial.html"><em>Writing extensions tutorial</em></a>.</p>
</li>
<li><p class="first">It calls <tt class="xref py py-func docutils literal"><span class="pre">implements()</span></tt> to declare that it
implements the <tt class="xref py py-class docutils literal"><span class="pre">IConfigurer</span></tt> plugin
interface:</p>
<p>This tells CKAN that our
<tt class="xref py py-class docutils literal"><span class="pre">ExampleThemePlugin</span></tt> class
implements the methods declared in the
<tt class="xref py py-class docutils literal"><span class="pre">IConfigurer</span></tt> interface. CKAN will call
these methods of our plugin class at the appropriate times.</p>
</li>
<li><p class="first">It implements the
<tt class="xref py py-meth docutils literal"><span class="pre">update_config()</span></tt> method, which
is the only method declared in the
<tt class="xref py py-class docutils literal"><span class="pre">IConfigurer</span></tt> interface:</p>
<p>CKAN will call this method when it starts up, to give our plugin a chance to
modify CKAN&#8217;s configuration settings. Our
<tt class="xref py py-meth docutils literal"><span class="pre">update_config()</span></tt>
method calls <tt class="xref py py-func docutils literal"><span class="pre">add_template_directory()</span></tt> to
register its custom template directory with CKAN.
This tells CKAN to look for template files in <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates</span></tt> whenever
it renders a page. Any template file in this directory that has the same
name as one of CKAN&#8217;s default template files, will be used instead of the
default file.</p>
</li>
</ol>
<p>Now, let&#8217;s customize the CKAN front page. We first need to discover which
template file CKAN uses to render the front page, so we can replace it.
Set <a class="reference internal" href="../maintaining/configuration.html#debug"><em>debug</em></a> to <tt class="docutils literal"><span class="pre">true</span></tt> in your <a href="#id12"><span class="problematic" id="id13">|development.ini|</span></a> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>

<span class="c"># WARNING: *THIS SETTING MUST BE SET TO FALSE ON A PRODUCTION ENVIRONMENT*</span>
<span class="n">debug</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p id="debug-footer">Reload the <a href="#id16"><span class="problematic" id="id17">`CKAN front page`_</span></a> in your browser, and you should see a <em>Debug</em>
link in the footer at the bottom of the page. Click on this link to open the
debug footer. The debug footer displays various information useful for CKAN
frontend development and debugging, including the names of the template files
that were used to render the current page:</p>
<img alt="The debug footer." src="../_images/debug-footer.png" />
<p>The first template file listed is the one we&#8217;re interested in:</p>
<div class="highlight-python"><div class="highlight"><pre>Template name: home/index.html
Template path: /usr/lib/ckan/default/src/ckan/ckan/templates/home/index.html
</pre></div>
</div>
<p>This tells us that <tt class="docutils literal"><span class="pre">home/index.html</span></tt> is the root template file used to render
the front page. The debug footer appears at the bottom of every CKAN page, and
can always be used to find the page&#8217;s template files, and other information
about the page.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Most CKAN pages are rendered from multiple template files.
The first file listed in the debug footer is the root template file of the
page. All other template files used to render the page (listed further down
in the debug footer) are either included by the root file, or included by
another file that is included by the root file.</p>
<p class="last">To figure out which template file renders a particular part of the page you
have to inspect the
<a class="reference external" href="https://github.com/ckan/ckan/tree/master/ckan/templates">source code of the template files</a>,
starting with the root file.</p>
</div>
<p>Now let&#8217;s override <tt class="docutils literal"><span class="pre">home/index.html</span></tt> using our plugins&#8217; custom <tt class="docutils literal"><span class="pre">templates</span></tt>
directory. Create the <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates</span></tt> directory, create a <tt class="docutils literal"><span class="pre">home</span></tt> directory
inside the <tt class="docutils literal"><span class="pre">templates</span></tt> directory, and create an empty <tt class="docutils literal"><span class="pre">index.html</span></tt> file
inside the <tt class="docutils literal"><span class="pre">home</span></tt> directory:</p>
<pre class="literal-block">
<tt class="docutils literal"><span class="pre">ckanext-example_theme</span></tt>/
  ckanext/
    example_theme/
      templates/
        home/
          index.html  &lt;-- An empty file.
</pre>
<p>If you now restart the development web server (kill the server using Ctrl-c,
then run the <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">serve</span></tt> command again) and reload the <a href="#id18"><span class="problematic" id="id19">`CKAN front page`_</span></a>
in your web browser, you should see an empty page, because we&#8217;ve replaced the
template file for the front page with an empty file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you run <tt class="docutils literal"><span class="pre">paster</span> <span class="pre">serve</span></tt> with the <tt class="docutils literal"><span class="pre">--reload</span></tt> option, then it isn&#8217;t
usually necessary to restart the server after editing a Python file,
a template file, your CKAN config file, or any other CKAN file. If you&#8217;ve
added a new file or directory, however, you need to restart the server
manually.</p>
</div>
</div>
<div class="section" id="jinja2">
<h2>Jinja2<a class="headerlink" href="#jinja2" title="Permalink to this headline">¶</a></h2>
<p>CKAN template files are written in the <a class="reference internal" href="#jinja2">Jinja2</a> templating language. Jinja
template files, such as our <tt class="docutils literal"><span class="pre">index.html</span></tt> file, are simply text files that,
when processed, generate any text-based output format such as <tt class="docutils literal"><span class="pre">HTML</span></tt>,
<tt class="docutils literal"><span class="pre">XML</span></tt>, <tt class="docutils literal"><span class="pre">CSV</span></tt>, etc. Most of the template files in CKAN generate <tt class="docutils literal"><span class="pre">HTML</span></tt>.</p>
<p>We&#8217;ll introduce some Jinja2 basics below. Jinja2 templates have many more
features than these, for full details see the
<a class="reference external" href="http://jinja.pocoo.org/docs/templates">Jinja2 docs</a>.</p>
<div class="section" id="expressions-and-variables">
<span id="id1"></span><h3>Expressions and variables<a class="headerlink" href="#expressions-and-variables" title="Permalink to this headline">¶</a></h3>
<p>Jinja2 <em>expressions</em> are snippets of code between <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></tt> delimiters,
when a template is rendered any expressions are evaluated and replaced with
the resulting value.</p>
<p>The simplest use of an expression is to display the value of a variable, for
example <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">foo</span> <span class="pre">}}</span></tt> in a template file will be replaced with the value of the
variable <tt class="docutils literal"><span class="pre">foo</span></tt> when the template is rendered.</p>
<p>CKAN makes a number of global variables available to all templates. One such
variable is <a class="reference internal" href="variables-and-functions.html#app_globals" title="app_globals"><tt class="xref py py-data docutils literal"><span class="pre">app_globals</span></tt></a>, which can be used to access certain global
attributes including some of the settings from your CKAN config file. For
example, to display the value of the <a class="reference internal" href="../maintaining/configuration.html#ckan-site-title"><em>ckan.site_title</em></a> setting from your
config file you would put this code in any template file:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="variables-and-functions.html#app_globals" title="app_globals"><tt class="xref py py-data docutils literal"><span class="pre">app_globals</span></tt></a> variable is also sometimes called <a class="reference internal" href="variables-and-functions.html#g" title="g"><tt class="xref py py-data docutils literal"><span class="pre">g</span></tt></a>
(an alias), you may see <a class="reference internal" href="variables-and-functions.html#g" title="g"><tt class="xref py py-data docutils literal"><span class="pre">g</span></tt></a> in some CKAN templates.
See <a class="reference internal" href="variables-and-functions.html"><em>Variables and functions available to templates</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Not all config settings are available to templates via
<a class="reference internal" href="variables-and-functions.html#app_globals" title="app_globals"><tt class="xref py py-data docutils literal"><span class="pre">app_globals</span></tt></a>. The <a class="reference internal" href="../maintaining/configuration.html#sqlalchemy-url"><em>sqlalchemy.url</em></a> setting, for example,
contains your database password, so making that variable available to
templates might be a security risk.</p>
<p class="last">If you&#8217;ve added your own custom options to your config file, these will not
be available in <a class="reference internal" href="variables-and-functions.html#app_globals" title="app_globals"><tt class="xref py py-data docutils literal"><span class="pre">app_globals</span></tt></a> automatically.
See <a class="reference internal" href="#accessing-custom-config-settings-from-templates"><em>Accessing custom config settings from templates</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If a template tries to render a variable or attribute that doesn&#8217;t exist,
rather than crashing or giving an error message, the Jinja2 expression
simply evaluates to nothing (an empty string). For example, these Jinja2
expressions will output nothing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">app_globals</span><span class="o">.</span><span class="n">an_attribute_that_does_not_exist</span> <span class="p">}}</span>

<span class="p">{{</span> <span class="n">a_variable_that_does_not_exist</span> <span class="p">}}</span>
</pre></div>
</div>
<p>If, on the other hand, you try to render an attribute of a variable that
doesn&#8217;t exist, then Jinja2 will crash. For example, this Jinja2 expression
will crash with an
<tt class="docutils literal"><span class="pre">UndefinedError:</span> <span class="pre">'a_variable_that_does_not_exist'</span> <span class="pre">is</span> <span class="pre">undefined</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">a_variable_that_does_not_exist</span><span class="o">.</span><span class="n">an_attribute_that_does_not_exist</span> <span class="p">}}</span>
</pre></div>
</div>
<p class="last">See the <a class="reference external" href="http://jinja.pocoo.org/docs/templates/#variables">Jinja2 variables docs</a>
for details.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Jinja2 expressions can do much more than print out the values of variables,
for example
they can call Jinja2&#8217;s <a class="reference external" href="http://jinja.pocoo.org/docs/templates/#list-of-global-functions">global functions</a>,
CKAN&#8217;s <a class="reference internal" href="#template-helper-functions"><em>template helper functions</em></a> and any
<a class="reference internal" href="#custom-template-helper-functions"><em>custom template helper functions</em></a>
provided by your extension,
and use any of the
<a class="reference external" href="http://jinja.pocoo.org/docs/templates/#expressions">literals and operators</a>
that Jinja provides.</p>
<p class="last">See <a class="reference internal" href="variables-and-functions.html"><em>Variables and functions available to templates</em></a> for a list of variables and
functions available to templates.</p>
</div>
</div>
<div class="section" id="tags">
<h3>Tags<a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../maintaining/configuration.html#ckan-site-title"><em>ckan.site_title</em></a> is an example of a simple string variable.
Some variables, such as <a class="reference internal" href="../maintaining/configuration.html#ckan-plugins"><em>ckan.plugins</em></a>, are lists, and can be looped over
using Jinja&#8217;s <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">%}</span></tt> tag.</p>
<p>Jinja <em>tags</em> are snippets of code between <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">...</span> <span class="pre">%}</span></tt> delimiters that control
the logic of the template. For example, we can output a list of the currently
enabled plugins with this code in any template file:</p>
<p>Other variables, such as <a class="reference internal" href="../maintaining/configuration.html#ckan-tracking-enabled"><em>ckan.tracking_enabled</em></a>, are booleans, and can be
tested using Jinja&#8217;s <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></tt> tag:</p>
</div>
<div class="section" id="comments">
<h3>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h3>
<p>Finally, any text between <tt class="docutils literal"><span class="pre">{#</span> <span class="pre">...</span> <span class="pre">#}</span></tt> delimiters in a Jinja2 template is a
<em>comment</em>, and will not be output when the template is rendered:</p>
</div>
</div>
<div class="section" id="extending-templates-with-ckan-extends">
<h2>Extending templates with <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">ckan_extends</span> <span class="pre">%}</span></tt><a class="headerlink" href="#extending-templates-with-ckan-extends" title="Permalink to this headline">¶</a></h2>
<p>CKAN provides a custom Jinja tag <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">ckan_extends</span> <span class="pre">%}</span></tt> that we can use to
declare that our <tt class="docutils literal"><span class="pre">home/index.html</span></tt> template extends the default
<tt class="docutils literal"><span class="pre">home/index.html</span></tt> template, instead of completely replacing it.
Edit the empty <tt class="docutils literal"><span class="pre">index.html</span></tt> file you just created, and add one line:</p>
<p>If you now reload the <a href="#id20"><span class="problematic" id="id21">`CKAN front page`_</span></a> in your browser, you should see the
normal front page appear again. When CKAN processes our <tt class="docutils literal"><span class="pre">index.html</span></tt> file,
the <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">ckan_extends</span> <span class="pre">%}</span></tt> tag tells it to process the default
<tt class="docutils literal"><span class="pre">home/index.html</span></tt> file first.</p>
</div>
<div class="section" id="replacing-template-blocks-with-block">
<h2>Replacing template blocks with <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">%}</span></tt><a class="headerlink" href="#replacing-template-blocks-with-block" title="Permalink to this headline">¶</a></h2>
<p>Jinja templates can contain <em>blocks</em> that child templates can override.  For
example, CKAN&#8217;s default <tt class="docutils literal"><span class="pre">home/layout1.html</span></tt> template (one of the files used
to render the CKAN front page) has a block that contains the Jinja and HTML
code for the &#8220;featured group&#8221; that appears on the front page:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This code calls a <a class="reference internal" href="#snippets"><em>template snippet</em></a> that contains the
actual Jinja and HTML code for the featured group, more on snippets later.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The CKAN front page supports a number of different layouts: layout1,
layout2, layout3, etc. The layout can be chosen by a sysadmin using the
<em class="xref std std-ref">admin page</em>. This tutorial assumes your CKAN is set to
use the first (default) layout.</p>
</div>
<p>When a custom template file extends one of CKAN&#8217;s default template files using
<tt class="docutils literal"><span class="pre">{%</span> <span class="pre">ckan_extends</span> <span class="pre">%}</span></tt>, it can replace any of the blocks from the default
template with its own code by using <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">%}</span></tt>. Create the file
<tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates/home/layout1.html</span></tt> with these contents:</p>
<p>This file extends the default <tt class="docutils literal"><span class="pre">layout1.html</span></tt> template, and overrides the
<tt class="docutils literal"><span class="pre">featured_group</span></tt> block.  Restart the development web server and reload the
<a href="#id22"><span class="problematic" id="id23">`CKAN front page`_</span></a> in your browser.  You should see that the featured groups
section of the page has been replaced, but the rest of the page remains intact.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most template files in CKAN contain multiple blocks.
To find out what blocks a template has, and which block renders a particular
part of the page, you have to look at the
<a class="reference external" href="https://github.com/ckan/ckan/tree/master/ckan/templates">source code of the default template files</a>.</p>
</div>
</div>
<div class="section" id="extending-parent-blocks-with-jinja-s-super">
<h2>Extending parent blocks with Jinja&#8217;s <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></tt><a class="headerlink" href="#extending-parent-blocks-with-jinja-s-super" title="Permalink to this headline">¶</a></h2>
<p>If you want to add some code to a block but don&#8217;t want to replace the entire
block, you can use Jinja&#8217;s <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></tt> tag:</p>
<p>When the child block above is rendered, Jinja will replace the
<tt class="docutils literal"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></tt> tag with the contents of the parent block.
The <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></tt> tag can be placed anywhere in the block.</p>
</div>
<div class="section" id="template-helper-functions">
<span id="id2"></span><h2>Template helper functions<a class="headerlink" href="#template-helper-functions" title="Permalink to this headline">¶</a></h2>
<p>Now let&#8217;s put some interesting content into our custom template block.
One way for templates to get content out of CKAN is by calling CKAN&#8217;s
<em>template helper functions</em>.</p>
<p>For example, let&#8217;s replace the featured group on the front page with an
activity stream of the site&#8217;s recently created, updated and deleted datasets.
Change the code in <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates/home/layout1.html</span></tt> to this:</p>
<p>Reload the <a href="#id24"><span class="problematic" id="id25">`CKAN front page`_</span></a> in your browser and you should see a new activity
stream:</p>
<img alt="The recently changed packages activity stream." src="../_images/recently-changed-packages-activity-stream.png" />
<p>To call a template helper function we use a Jinja2 <em>expression</em> (code wrapped
in <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></tt> brackets), and we use the global variable <a class="reference internal" href="variables-and-functions.html#h" title="h"><tt class="xref py py-data docutils literal"><span class="pre">h</span></tt></a>
(available to all templates) to access the helper:</p>
<p>To see what other template helper functions are available, look at the
<a class="reference internal" href="template-helper-functions.html"><em>template helper functions reference docs</em></a>.</p>
</div>
<div class="section" id="adding-your-own-template-helper-functions">
<span id="custom-template-helper-functions"></span><h2>Adding your own template helper functions<a class="headerlink" href="#adding-your-own-template-helper-functions" title="Permalink to this headline">¶</a></h2>
<p>Plugins can add their own template helper functions by implementing CKAN&#8217;s
<tt class="xref py py-class docutils literal"><span class="pre">ITemplateHelpers</span></tt> plugin interface.
(see <a class="reference internal" href="../extensions/tutorial.html"><em>Writing extensions tutorial</em></a> for a detailed explanation of CKAN plugins and
plugin interfaces).</p>
<p>Let&#8217;s add another item to our custom front page: a list of the most &#8220;popular&#8221;
groups on the site (the groups with the most datasets).  We&#8217;ll add a custom
template helper function to select the groups to be shown.  First, in our
<tt class="docutils literal"><span class="pre">plugin.py</span></tt> file we need to implement
<tt class="xref py py-class docutils literal"><span class="pre">ITemplateHelpers</span></tt> and provide our helper
function. Change the contents of <tt class="docutils literal"><span class="pre">plugin.py</span></tt> to look like this:</p>
<p>We&#8217;ve added a number of new features to <tt class="docutils literal"><span class="pre">plugin.py</span></tt>. First, we defined a
function to get the most popular groups from CKAN:</p>
<p>This function calls one of CKAN&#8217;s <em>action functions</em> to get the groups from
CKAN.  See <a class="reference internal" href="../extensions/tutorial.html"><em>Writing extensions tutorial</em></a> for more about action functions.</p>
<p>Next, we called <tt class="xref py py-func docutils literal"><span class="pre">implements()</span></tt> to declare that our class
now implements <tt class="xref py py-class docutils literal"><span class="pre">ITemplateHelpers</span></tt>:</p>
<p>Finally, we implemented the
<tt class="xref py py-meth docutils literal"><span class="pre">get_helpers()</span></tt> method from
<tt class="xref py py-class docutils literal"><span class="pre">ITemplateHelpers</span></tt> to register our function
as a template helper:</p>
<p>Now that we&#8217;ve registered our helper function, we need to call it from our
template. As with CKAN&#8217;s default template helpers, templates access custom
helpers via the global variable <a class="reference internal" href="variables-and-functions.html#h" title="h"><tt class="xref py py-data docutils literal"><span class="pre">h</span></tt></a>.
Edit <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates/home/layout1.html</span></tt> to look like this:</p>
<p>Now reload your <a href="#id26"><span class="problematic" id="id27">`CKAN front page`_</span></a> in your browser. You should see the featured
organization section replaced with a list of the most popular groups:</p>
<img alt="The most popular groups." src="../_images/most-popular-groups.png" />
<p>Simply displaying a list of group titles isn&#8217;t very good. We want the groups to
be hyperlinked to their pages, and also to show some other information about
the group such as its description and logo image. To display our groups nicely,
we&#8217;ll use CKAN&#8217;s <em>template snippets</em>...</p>
</div>
<div class="section" id="template-snippets">
<span id="snippets"></span><h2>Template snippets<a class="headerlink" href="#template-snippets" title="Permalink to this headline">¶</a></h2>
<p><em>Template snippets</em> are small snippets of template code that, just like helper
functions, can be called from any template file. To call a snippet, you use
another of CKAN&#8217;s custom Jinja2 tags: <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">snippet</span> <span class="pre">%}</span></tt>. CKAN comes with a
selection of snippets, which you can find in the various <tt class="docutils literal"><span class="pre">snippets</span></tt>
directories in <a class="reference external" href="https://github.com/ckan/ckan/tree/master/ckan/templates">ckan/templates/</a>,
such as <a class="reference external" href="https://github.com/ckan/ckan/tree/master/ckan/templates/snippets">ckan/templates/snippets/</a>
and <a class="reference external" href="https://github.com/ckan/ckan/tree/master/ckan/templates/package/snippets">ckan/templates/package/snippets/</a>.
For a complete list of the default snippets available to templates, see
<a class="reference internal" href="template-snippets.html"><em>Template snippets reference</em></a>.</p>
<p><tt class="docutils literal"><span class="pre">ckan/templates/group/snippets/group_list.html</span></tt> is a snippet that renders a
list of groups nicely (it&#8217;s used to render the groups on CKAN&#8217;s <tt class="docutils literal"><span class="pre">/group</span></tt> page
and on user dashboard pages, for example):</p>
<p>(As you can see, this snippet calls another snippet, <tt class="docutils literal"><span class="pre">group_item.html</span></tt>, to
render each individual group.)</p>
<p>Let&#8217;s change our <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates/home/layout1.html</span></tt> file to call this snippet:</p>
<p>Here we pass two arguments to the <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">snippet</span> <span class="pre">%}</span></tt> tag:</p>
<p>the first argument is the name of the snippet file to call. The second
argument, separated by a comma, is the list of groups to pass into the snippet.
After the filename you can pass any number of variables into a snippet, and
these will all be available to the snippet code as top-level global variables.
As in the <tt class="docutils literal"><span class="pre">group_list.html</span></tt> docstring above, each snippet&#8217;s docstring
should document the parameters it requires.</p>
<p>If you reload your <a href="#id28"><span class="problematic" id="id29">`CKAN front page`_</span></a> in your web browser now, you should see
the most popular groups rendered in the same style as the list of groups on
the <tt class="docutils literal"><span class="pre">/groups</span></tt> page:</p>
<img alt="The most popular groups, rendered by a default snippet." src="../_images/most-popular-groups-snippet.png" />
<p>This style isn&#8217;t really what we want for our front page, each group is too big.
To render the groups in a custom style, we can define a custom snippet...</p>
</div>
<div class="section" id="adding-your-own-template-snippets">
<h2>Adding your own template snippets<a class="headerlink" href="#adding-your-own-template-snippets" title="Permalink to this headline">¶</a></h2>
<p>Just as plugins can add their own template helper functions, they can also add
their own snippets. To add template snippets, all a plugin needs to do is add a
<tt class="docutils literal"><span class="pre">snippets</span></tt> directory in its <tt class="docutils literal"><span class="pre">templates</span></tt> directory, and start adding files.
The snippets will be callable from other templates immediately.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For CKAN to find your plugins&#8217; snippets directories, you should already have
added your plugin&#8217;s custom template directory to CKAN, see <a class="reference internal" href="#template-overriding"><em>Replacing a default template file</em></a>.</p>
</div>
<p>Let&#8217;s create a custom snippet to display our most popular groups, we&#8217;ll put
the <tt class="docutils literal"><span class="pre">&lt;h3&gt;Most</span> <span class="pre">popular</span> <span class="pre">groups&lt;/h3&gt;</span></tt> heading into the snippet and make it nice
and modular, so that we can reuse the whole thing on different parts of the
site if we want to.</p>
<p>Create a new directory <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates/snippets</span></tt> containing a file named
<tt class="docutils literal"><span class="pre">example_theme_most_popular_groups.html</span></tt> with these contents:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As in the example above, a snippet should have a docstring at the top of the
file that briefly documents what the snippet does and what parameters it
requires. See <a class="reference internal" href="best-practices.html#snippet-docstrings-best-practice"><em>Snippets should have docstrings</em></a>.</p>
</div>
<p>This code uses a Jinja2 <tt class="docutils literal"><span class="pre">for</span></tt> loop to render each of the groups, and calls a
number of CKAN&#8217;s template helper functions:</p>
<ul class="simple">
<li>To hyperlink each group&#8217;s name to the group&#8217;s page, it calls
<tt class="xref py py-func docutils literal"><span class="pre">url_for()</span></tt>.</li>
<li>If the group has a description, it calls
<tt class="xref py py-func docutils literal"><span class="pre">markdown_extract()</span></tt> to render the description
nicely.</li>
<li>If the group doesn&#8217;t have a description, it uses the <a class="reference internal" href="variables-and-functions.html#_" title="_"><tt class="xref py py-func docutils literal"><span class="pre">_()</span></tt></a> function to
mark the <tt class="docutils literal"><span class="pre">'This</span> <span class="pre">group</span> <span class="pre">has</span> <span class="pre">no</span> <span class="pre">description'</span></tt> message for translation.
When the page is rendered in a user&#8217;s web browser, this string will be shown
in the user&#8217;s language (if there&#8217;s a translation of the string into that
language).</li>
<li>When rendering the group&#8217;s number of datasets, it uses the
<a class="reference internal" href="variables-and-functions.html#ungettext" title="ungettext"><tt class="xref py py-func docutils literal"><span class="pre">ungettext()</span></tt></a> function to mark the message for translation with
localized handling of plural forms.</li>
</ul>
<p>The code also accesses the attributes of each group: <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">group.name</span> <span class="pre">}}`,</span>
<span class="pre">``{{</span> <span class="pre">group.display_name</span> <span class="pre">}}</span></tt>, <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">group.description</span> <span class="pre">}}</span></tt>,
<tt class="docutils literal"><span class="pre">{{</span> <span class="pre">group.packages</span> <span class="pre">}}</span></tt>, etc. To see what attributes a group or any other CKAN
object (packages/datasets, organizations, users...) has, you can use
<a class="reference internal" href="../api/index.html"><em>CKAN&#8217;s API</em></a> to inspect the object. For example to find out what
attributes a group has, call the <tt class="xref py py-func docutils literal"><span class="pre">group_show()</span></tt>
function.</p>
<p>Now edit your <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates/home/layout1.html</span></tt> file and change it to use our new snippet instead
of the default one:</p>
<p>Restart the development web server and reload the <a href="#id30"><span class="problematic" id="id31">`CKAN front page`_</span></a> and you
should see the most popular groups rendered differently:</p>
<img alt="The most popular groups, rendered by a custom snippet." src="../_images/most-popular-groups-custom-snippet.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Default snippets can be overridden.
If a plugin adds a snippet with the same name as one of CKAN&#8217;s default
snippets, the plugin&#8217;s snippet will override the default snippet wherever
the default snippet is used.</p>
<p>Also if two plugins both have snippets with the same name, one of the
snippets will override the other.</p>
<p class="last">To avoid unintended conflicts, we recommend that snippet filenames begin
with the name of the extension they belong to, e.g.
<tt class="docutils literal"><span class="pre">snippets/example_theme_*.html</span></tt>.
See <a class="reference internal" href="best-practices.html#snippet-filenames-best-practice"><em>Snippet filenames should begin with the name of the extension</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Snippets don&#8217;t have access to the global template context variable,
<a class="reference internal" href="variables-and-functions.html#c" title="c"><tt class="xref py py-data docutils literal"><span class="pre">c</span></tt></a> (see <a class="reference internal" href="variables-and-functions.html"><em>Variables and functions available to templates</em></a>).
Snippets <em>can</em> access other global variables such as <a class="reference internal" href="variables-and-functions.html#h" title="h"><tt class="xref py py-data docutils literal"><span class="pre">h</span></tt></a>,
<a class="reference internal" href="variables-and-functions.html#app_globals" title="app_globals"><tt class="xref py py-data docutils literal"><span class="pre">app_globals</span></tt></a> and <a class="reference internal" href="variables-and-functions.html#request" title="request"><tt class="xref py py-data docutils literal"><span class="pre">request</span></tt></a>, as well as any variables
explicitly passed into the snippet by the parent template when it calls the
snippet with a <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">snippet</span> <span class="pre">%}</span></tt> tag.</p>
</div>
</div>
<div class="section" id="html-tags-and-css-classes">
<h2>HTML tags and CSS classes<a class="headerlink" href="#html-tags-and-css-classes" title="Permalink to this headline">¶</a></h2>
<p>Our additions to the front page so far don&#8217;t look very good or fit in very well
with the CKAN theme. Let&#8217;s make them look better by tweaking our template to
use the right HTML tags and CSS classes.</p>
<p>There are two places to look for CSS classes available in CKAN:</p>
<ol class="arabic">
<li><p class="first">The <a class="reference external" href="bootstrap">Bootstrap 2.3.2 docs</a>. All of the HTML, CSS and JavaScript
provided by Bootstrap is available to use in CKAN.</p>
</li>
<li><p class="first">CKAN&#8217;s development primer page, which can be found on any CKAN site at
<tt class="docutils literal"><span class="pre">/development/primer.html</span></tt>, for example
<a class="reference external" href="http://demo.ckan.org/development/primer.html">demo.ckan.org/development/primer.html</a>.</p>
<p>The primer page demonstrates many of the HTML and CSS elements available in
CKAN, and by viewing the source of the page you can see what HTML tags and
CSS classes they use.</p>
</li>
</ol>
<p>Edit your <tt class="docutils literal"><span class="pre">example_theme_most_popular_groups.html</span></tt> file to look like this:</p>
<p>This simply wraps the code in a <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;box&quot;&gt;</span></tt>,
a <tt class="docutils literal"><span class="pre">&lt;header</span> <span class="pre">class=&quot;module-heading&quot;&gt;</span></tt>,
and a <tt class="docutils literal"><span class="pre">&lt;section</span> <span class="pre">class=&quot;module-content&quot;&gt;</span></tt>. We also added Bootstrap&#8217;s
<tt class="docutils literal"><span class="pre">class=&quot;unstyled&quot;</span></tt> to the <tt class="docutils literal"><span class="pre">&lt;ul&gt;</span></tt> tag to get rid of the bullet points.
If you reload the <a href="#id32"><span class="problematic" id="id33">`CKAN front page`_</span></a>, the most popular groups should look much
better.</p>
<p>To wrap your activity stream in a similar box, edit <tt class="docutils literal"><span class="pre">layout1.html</span></tt> to look
like this:</p>
<p>Reload the <a href="#id34"><span class="problematic" id="id35">`CKAN front page`_</span></a>, and you should see your activity stream and
most popular groups looking much better:</p>
<img alt="The activity stream and most popular groups, with better CSS." src="../_images/html_and_css.png" />
</div>
<div class="section" id="accessing-custom-config-settings-from-templates">
<span id="id3"></span><h2>Accessing custom config settings from templates<a class="headerlink" href="#accessing-custom-config-settings-from-templates" title="Permalink to this headline">¶</a></h2>
<p>Not all CKAN config settings are available to templates via
<a class="reference internal" href="variables-and-functions.html#app_globals" title="app_globals"><tt class="xref py py-data docutils literal"><span class="pre">app_globals</span></tt></a>. In particular, if an extension wants to use its own
custom config setting, this setting will not be available. If you need to
access a custom config setting from a template, you can do so by wrapping the
config setting in a helper function.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For more on custom config settings, see
<a class="reference internal" href="../extensions/custom-config-settings.html"><em>Using custom config settings in extensions</em></a>.</p>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">I&#8217;m not sure if making config settings available to templates like this is
a very good idea. Is there an alternative best practice?</p>
</div>
<p>Let&#8217;s add a config setting, <tt class="docutils literal"><span class="pre">show_most_popular_groups</span></tt>, to enable or disable
the most popular groups on the front page. First, add a new helper function to
<tt class="docutils literal"><span class="pre">plugin.py</span></tt> to wrap the config setting.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Names of config settings provided by extensions should include the name
of the extension, to avoid conflicting with core config settings or with
config settings from other extensions.
See <a class="reference internal" href="../extensions/best-practices.html#extension-config-setting-names-best-practice"><em>Names of config settings should include the name of the extension</em></a>.</p>
</div>
<p>Now we can call this helper function from our <tt class="docutils literal"><span class="pre">layout1.html</span></tt> template:</p>
<p>If the user sets this config setting to <tt class="docutils literal"><span class="pre">True</span></tt> in their CKAN config file,
then the most popular groups will be displayed on the front page, otherwise
the block will fall back to its default contents.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
            <li class="right" style="margin-right: 10px">
              <a href="../genindex.html" title="General Index"
                 accesskey="I">index</a></li>
        <li><a href="../index.html">doc</a> &raquo;</li>
        <li><a href="#">Customizing CKAN&#8217;s templates</a></li>
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014 GeoSolutions.
      Last updated on Aug 03, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>