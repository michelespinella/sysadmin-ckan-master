<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JavaScript coding standards &mdash; DRDSI CKAN doc</title>
    
    <link rel="stylesheet" href="../_static/geosolutions.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '20140422',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="DRDSI CKAN doc" href="../index.html" />
    

  </head>
  <body>
    <div class="header">
        <div class="wrap">
			
            <div class="logo">
			<a href="http://geo-solutions.it/"><img src="../_static/img/geosolutions.png" alt="GeoSolutions" /></a>
			<div class="social-container"> 
				<ul id="social">
					<li><a href="https://plus.google.com/u/0/100131944378031878024/posts" id="gplus">Google+</a></li>
					<li><a href="http://twitter.com/geosolutions_it/" id="twitter">Twitter</a></li>
				</ul>
			</div>
			</div>
					
            <h2 class="docstitle"><a href="../index.html">DRDSI CKAN doc</a></h2>
			
        </div>
    </div>


      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">JavaScript coding standards</a><ul>
<li><a class="reference internal" href="#formatting">Formatting</a><ul>
<li><a class="reference internal" href="#white-space">White space</a></li>
<li><a class="reference internal" href="#quotes">Quotes</a></li>
<li><a class="reference internal" href="#variable-declarations">Variable declarations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#naming">Naming</a></li>
<li><a class="reference internal" href="#comments">Comments</a></li>
<li><a class="reference internal" href="#jshint">JSHint</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#best-practices">Best practices</a><ul>
<li><a class="reference internal" href="#forms">Forms</a></li>
<li><a class="reference internal" href="#ajax">Ajax</a></li>
<li><a class="reference internal" href="#event-handlers">Event handlers</a></li>
<li><a class="reference internal" href="#templating">Templating</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/contributing/javascript.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="javascript-coding-standards">
<h1>JavaScript coding standards<a class="headerlink" href="#javascript-coding-standards" title="Permalink to this headline">¶</a></h1>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="string-i18n.html"><em>String internationalization</em></a></dt>
<dd>How to mark strings for translation.</dd>
</dl>
</div>
<div class="section" id="formatting">
<h2>Formatting<a class="headerlink" href="#formatting" title="Permalink to this headline">¶</a></h2>
<p>All JavaScript documents must use <strong>two spaces</strong> for indentation. This is
contrary to the <a class="reference external" href="http://wiki.okfn.org/Coding_Standards#Javascript">OKFN Coding Standards</a> but matches what&#8217;s in use in the
current code base.</p>
<p>Coding style must follow the <a class="reference external" href="https://github.com/rwldrn/idiomatic.js/">idiomatic.js</a> style but with the following
exceptions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Idiomatic is heavily based upon <a class="reference external" href="http://javascript.crockford.com/code.html">Douglas Crockford&#8217;s</a> style
guide which is recommended by the <a class="reference external" href="http://wiki.okfn.org/Coding_Standards#Javascript">OKFN Coding Standards</a>.</p>
</div>
<div class="section" id="white-space">
<h3>White space<a class="headerlink" href="#white-space" title="Permalink to this headline">¶</a></h3>
<p>Two spaces must be used for indentation at all times. Unlike in idiomatic
whitespace must not be used _inside_ parentheses between the parentheses
and their Contents.</p>
<div class="highlight-python"><div class="highlight"><pre>// BAD: Too much whitespace.
function getUrl( full ) {
  var url = &#39;/styleguide/javascript/&#39;;
  if ( full ) {
    url = &#39;http://okfn.github.com/ckan&#39; + url;
  }
  return url;
}

// GOOD:
function getUrl(full) {
  var url = &#39;/styleguide/javascript/&#39;;
  if (full) {
    url = &#39;http://okfn.github.com/ckan&#39; + url;
  }
  return url;
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See section 2.D.1.1 of idiomatic for more examples of this syntax.</p>
</div>
</div>
<div class="section" id="quotes">
<h3>Quotes<a class="headerlink" href="#quotes" title="Permalink to this headline">¶</a></h3>
<p>Single quotes should be used everywhere unless writing JSON or the string
contains them. This makes it easier to create strings containing HTML.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">jQuery</span><span class="p">(</span><span class="s">&#39;&lt;div id=&quot;my-div&quot; /&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">appendTo</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Object properties need not be quoted unless required by the interpreter.</p>
<div class="highlight-python"><div class="highlight"><pre>var object = {
  name: &#39;bill&#39;,
  &#39;class&#39;: &#39;user-name&#39;
};
</pre></div>
</div>
</div>
<div class="section" id="variable-declarations">
<h3>Variable declarations<a class="headerlink" href="#variable-declarations" title="Permalink to this headline">¶</a></h3>
<p>One <tt class="docutils literal"><span class="pre">var</span></tt> statement must be used per variable assignment. These must be
declared at the top of the function in which they are being used.</p>
<div class="highlight-python"><div class="highlight"><pre>// GOOD:
var good = &#39;string&#39;;
var alsoGood = &#39;another&#39;;

// GOOD:
var good = &#39;string&#39;;
var okay = [
  &#39;hmm&#39;, &#39;a bit&#39;, &#39;better&#39;
];

// BAD:
var good = &#39;string&#39;,
    iffy = [
  &#39;hmm&#39;, &#39;not&#39;, &#39;great&#39;
];
</pre></div>
</div>
<p>Declare variables at the top of the function in which they are first used. This
avoids issues with variable hoisting. If a variable is not assigned a value
until later in the function then it it okay to define more than one per
statement.</p>
<div class="highlight-python"><div class="highlight"><pre>// BAD: contrived example.
function lowercaseNames(names) {
  var names = [];

  for (var index = 0, length = names.length; index &lt; length; index += 1) {
    var name = names[index];
    names.push(name.toLowerCase());
  }

  var sorted = names.sort();
  return sorted;
}

// GOOD:
function lowercaseNames(names) {
  var names = [];
  var index, sorted, name;

  for (index = 0, length = names.length; index &lt; length; index += 1) {
    name = names[index];
    names.push(name.toLowerCase());
  }

  sorted = names.sort();
  return sorted;
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="naming">
<h2>Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h2>
<p>All properties, functions and methods must use lowercase camelCase:</p>
<div class="highlight-python"><div class="highlight"><pre>var myUsername = &#39;bill&#39;;
var methods = {
  getSomething: function () {}
};
</pre></div>
</div>
<p>Constructor functions must use uppercase CamelCase:</p>
<div class="highlight-python"><div class="highlight"><pre>function DatasetSearchView() {
}
</pre></div>
</div>
<p>Constants must be uppercase with spaces delimited by underscores:</p>
<div class="highlight-python"><div class="highlight"><pre>var env = {
  PRODUCTION:  &#39;production&#39;,
  DEVELOPMENT: &#39;development&#39;,
  TESTING:     &#39;testing&#39;
};
</pre></div>
</div>
<p>Event handlers and callback functions should be prefixed with &#8220;on&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre>function onDownloadClick(event) {}

jQuery(&#39;.download&#39;).click(onDownloadClick);
</pre></div>
</div>
<p>Boolean variables or methods returning boolean functions should prefix
the variable name with &#8220;is&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre>function isAdmin() {}

var canEdit = isUser() &amp;&amp; isAdmin();
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Alternatives are &#8220;has&#8221;, &#8220;can&#8221; and &#8220;should&#8221; if they make more sense</p>
</div>
<p>Private methods should be prefixed with an underscore:</p>
<div class="highlight-python"><div class="highlight"><pre>View.extend({
  &quot;click&quot;: &quot;_onClick&quot;,
  _onClick: function (event) {
  }
});
</pre></div>
</div>
<p>Functions should be declared as named functions rather than assigning an
anonymous function to a variable.</p>
<div class="highlight-python"><div class="highlight"><pre>// GOOD:
function getName() {
}

// BAD:
var getName = function () {
};
</pre></div>
</div>
<p>Named functions are generally easier to debug as they appear named in the
debugger.</p>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<p>Comments should be used to explain anything that may be unclear when you return
to it in six months time. Single line comments should be used for all inline
comments that do not form part of the documentation.</p>
<div class="highlight-python"><div class="highlight"><pre>// Export the function to either the exports or global object depending
// on the current environment. This can be either an AMD module, CommonJS
// module or a browser.
if (typeof module.define === &#39;function&#39; &amp;&amp; module.define.amd) {
  module.define(&#39;broadcast&#39;, function () {
    return Broadcast;
  });
} else if (module.exports) {
  module.exports = Broadcast;
} else {
  module.Broadcast = Broadcast;
}
</pre></div>
</div>
</div>
<div class="section" id="jshint">
<h2>JSHint<a class="headerlink" href="#jshint" title="Permalink to this headline">¶</a></h2>
<p>All JavaScript should pass <a class="reference external" href="http://www.jshint.com">JSHint</a> before being committed. This can
be installed using <tt class="docutils literal"><span class="pre">npm</span></tt> (which is bundled with <a class="reference external" href="http://nodejs.org">node</a>) by running:</p>
<div class="highlight-python"><div class="highlight"><pre>$ npm -g install jshint
</pre></div>
</div>
<p>Each project should include a jshint.json file with appropriate configuration
options for the tool. Most text editors can also be configured to read from
this file.</p>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>For documentation we use a simple markup format to document all methods. The
documentation should provide enough information to show the reader what the
method does, arguments it accepts and a general example of usage. Also
for API&#8217;s and third party libraries, providing links to external documentation
is encouraged.</p>
<p>The formatting is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>/* My method description. Should describe what the method does and where
 * it should be used.
 *
 * param1 - The method params, one per line (default: null)
 * param2 - A default can be provided in brackets at the end.
 *
 * Example
 *
 *   // Indented two spaces. Should give a common example of use.
 *   client.getTemplate(&#39;index.html&#39;, {limit: 1}, function (html) {
 *     module.el.html(html);
 *   });
 *
 * Returns describes what the object returns.
 */
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>/* Loads an HTML template from the CKAN snippet API endpoint. Template
 * variables can be passed through the API using the params object.
 *
 * Optional success and error callbacks can be provided or these can
 * be attached using the returns jQuery promise object.
 *
 * filename - The filename of the template to load.
 * params   - An optional object containing key/value arguments to be
 *            passed into the template.
 * success  - An optional success callback to be called on load. This will
 *            recieve the HTML string as the first argument.
 * error    - An optional error callback to be called if the request fails.
 *
 * Example
 *
 *   client.getTemplate(&#39;index.html&#39;, {limit: 1}, function (html) {
 *     module.el.html(html);
 *   });
 *
 * Returns a jqXHR promise object that can be used to attach callbacks.
 */
</pre></div>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>For unit testing we use the following libraries.</p>
<ul class="simple">
<li><a class="reference external" href="http://visionmedia.github.com/mocha/">Mocha</a>: As a BDD unit testing framework.</li>
<li><a class="reference external" href="http://chaijs.com/">Sinon</a>: Provides spies, stubs and mocks for methods and functions.</li>
<li><a class="reference external" href="http://sinonjs.org/docs/">Chai</a>: Provides common assertions.</li>
</ul>
<p>Tests are run from the test/index.html directory. We use the BDD interface
(<tt class="docutils literal"><span class="pre">describe()</span></tt>, <tt class="docutils literal"><span class="pre">it()</span></tt> etc.) provided by mocha and the assert interface
provided by chai.</p>
<p>Generally we try and have the core functionality of all libraries and modules
unit tested.</p>
</div>
<div class="section" id="best-practices">
<h2>Best practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h2>
<div class="section" id="forms">
<h3>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h3>
<p>All forms should work without JavaScript enabled. This means that they must
submit <tt class="docutils literal"><span class="pre">application/x-www-form-urlencoded</span></tt> data to the server and receive an
appropriate response. The server should check for the <tt class="docutils literal"><span class="pre">X-Requested-With:</span>
<span class="pre">XMLHTTPRequest</span></tt> header to determine if the request is an ajax one. If so it
can return an appropriate format, otherwise it should issue a 303 redirect.</p>
<p>The one exception to this rule is if a form or button is injected with
JavaScript after the page has loaded. It&#8217;s then not part of the HTML document
and can submit any data format it pleases.</p>
</div>
<div class="section" id="ajax">
<h3>Ajax<a class="headerlink" href="#ajax" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Calls to the CKAN API from JavaScript should be done through the
<a class="reference external" href="./frontend-development.html#client">CKAN client</a>.</p>
</div>
<p>Ajax requests can be used to improve the experience of submitting forms and
other actions that require server interactions. Nearly all requests will
go through the following states.</p>
<ol class="arabic simple">
<li>User clicks button.</li>
<li>JavaScript intercepts the click and disables the button (add <tt class="docutils literal"><span class="pre">disabled</span></tt>
attr).</li>
<li>A loading indicator is displayed (add class <tt class="docutils literal"><span class="pre">.loading</span></tt> to button).</li>
<li>The request is made to the server.</li>
<li><ol class="first loweralpha">
<li>On success the interface is updated.</li>
<li>On error a message is displayed to the user if there is no other way to
resolve the issue.</li>
</ol>
</li>
<li>The loading indicator is removed.</li>
<li>The button is re-enabled.</li>
</ol>
<p>Here&#8217;s a possible example for submitting a search form using jQuery.</p>
<div class="highlight-python"><div class="highlight"><pre>jQuery(&#39;#search-form&#39;).submit(function (event) {
  var form = $(this);
  var button = $(&#39;[type=submit]&#39;, form);

  // Prevent the browser submitting the form.
  event.preventDefault();

  button.prop(&#39;disabled&#39;, true).addClass(&#39;loading&#39;);

  jQuery.ajax({
    type: this.method,
    data: form.serialize(),
    success: function (results) {
      updatePageWithResults(results);
    },
    error: function () {
      showSearchError(&#39;Sorry we were unable to complete this search&#39;);
    },
    complete: function () {
      button.prop(&#39;disabled&#39;, false).removeClass(&#39;loading&#39;);
    }
  });
});
</pre></div>
</div>
<p>This covers possible issues that might arise from submitting the form as well
as providing the user with adequate feedback that the page is doing something.
Disabling the button prevents the form being submitted twice and the error
feedback should hopefully offer a solution for the error that occurred.</p>
</div>
<div class="section" id="event-handlers">
<h3>Event handlers<a class="headerlink" href="#event-handlers" title="Permalink to this headline">¶</a></h3>
<p>When using event handlers to listen for browser events it&#8217;s a common
requirement to want to cancel the default browser action. This should be
done by calling the <tt class="docutils literal"><span class="pre">event.preventDefault()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre>jQuery(&#39;button&#39;).click(function (event) {
  event.preventDefault();
});
</pre></div>
</div>
<p>It is also possible to return <tt class="docutils literal"><span class="pre">false</span></tt> from the callback function. Avoid doing
this as it also calls the <tt class="docutils literal"><span class="pre">event.stopPropagation()</span></tt> method which prevents the
event from bubbling up the DOM tree. This prevents other handlers listening
for the same event. For example an analytics click handler attached to the
<tt class="docutils literal"><span class="pre">&lt;body&gt;</span></tt> element.</p>
<p>Also jQuery (1.7+) now provides the <a class="reference external" href="http://api.jquery.com/on/">.on()</a> and <a class="reference external" href="http://api.jquery.com/off/">.off()</a>  methods as
alternatives to <tt class="docutils literal"><span class="pre">.bind()</span></tt>, <tt class="docutils literal"><span class="pre">.unbind()</span></tt>, <tt class="docutils literal"><span class="pre">.delegate()</span></tt> and
<tt class="docutils literal"><span class="pre">.undelegate()</span></tt> and they should be preferred for all tasks.</p>
</div>
<div class="section" id="templating">
<h3>Templating<a class="headerlink" href="#templating" title="Permalink to this headline">¶</a></h3>
<p>Small templates that will not require customisation by the instance can be
placed inline. If you need to create multi-line templates use an array rather
than escaping newlines within a string:</p>
<div class="highlight-python"><div class="highlight"><pre>var template = [
  &#39;&lt;li&gt;&#39;,
  &#39;&lt;span&gt;&lt;/span&gt;&#39;,
  &#39;&lt;/li&gt;&#39;
].join(&#39;&#39;);
</pre></div>
</div>
<p>Always localise text strings within your templates. If you are including them
inline this can always be done with jQuery:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">jQuery</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;This is my text string&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Larger templates can be loaded in using the CKAN snippet API. Modules get
access to this functionality via the <tt class="docutils literal"><span class="pre">sandbox.client</span></tt> object:</p>
<div class="highlight-python"><div class="highlight"><pre>initialize: function () {
  var el = this.el;
  this.sandbox.client.getTemplate(&#39;dataset.html&#39;, function (html) {
    el.html(html);
  });
}
</pre></div>
</div>
<p>The primary benefits of this is that the localisation can be done by the server
and it keeps the JavaScript modules free from large strings.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
            <li class="right" style="margin-right: 10px">
              <a href="../genindex.html" title="General Index"
                 accesskey="I">index</a></li>
        <li><a href="../index.html">doc</a> &raquo;</li>
        <li><a href="#">JavaScript coding standards</a></li>
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014 GeoSolutions.
      Last updated on Aug 03, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>